---
import {supabase} from "../../lib/supabase";

export const prerender = false

const {url, cookies, redirect} = Astro

const authCode = url.searchParams.get("code");

if (!authCode) {
    console.log("No auth code found");
}

const { data, error } = await supabase.auth.exchangeCodeForSession(authCode)

if (error) {
    console.log("Error", error.message)
}

const { access_token, refresh_token } = data.session;

cookies.set("sb-access-token", access_token, {
    path: "/",
});
cookies.set("sb-refresh-token", refresh_token, {
    path: "/",
});

return redirect("/")
---
